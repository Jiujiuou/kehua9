(function(){"use strict";const p=["的","了","在","是","我","有","和","就","不","人","都","一","个","上","也","很","到","说","要","去","你","会","着","没有","看","好","自己","这","但","那","她","他","它","我们","你们","他们","啊","哦","嗯","吧","呢","吗","呀","啦","哇","嘛","哈","唉","而","且","并","或","如果","因为","所以","然后","但是","虽然","即使","而且","或者","这个","那个","这些","那些","什么","怎么","为什么","可以","可能","一定","真的","其实","觉得","知道","想要","需要","应该","时候","开始","时间","感觉","已经","突然","后来","发现","起来","以后","今天","许多","最近","大家","小时","能力","好像","一种","一些","那么","就是","变成","然而","此时","之中","依然","不了","一样","的事","的时候","的时间","也不知道","不知道是","可能是因","在吃饭的","转租者是","号牙长得","有一些老","我更愿意","年纪大了","没有办法","很久没有","突然想到","非常","特别","极","极其","十分","格外","分外","相当","异常","颇为","多么","何等","非常之","特别地","尤其","有点","有些","稍微","略微","比较","较为","特别特别","超级","超","巨","狂","贼","绝","顶","忽然","猛地","骤然","陡然","经常","常常","时常","通常","总是","一直","始终","永远","从来","随时","偶尔","间或","有时","曾经","早已","早就","最后","顿时","立刻","马上","立即","即刻","方才","刚刚","刚才","忽然间","突然间","经常性","时不时","常年","平日","往常","似乎","也许","大概","几乎","仿佛","看起来","看上去","一般","基本上","完全","彻底","绝对","肯定","必然","必须","事实上","实际上"],g=new Set(["的","了","在","是","我","有","和","就","不","人","都","一","个","上","也","很","到","说","要","去","你","会","着","没","看","好","这","但","那","她","他","它","啊","哦","嗯","吧","呢","吗","呀","啦","而","且","并","或","与","及","等","过","地","得"]),S=new Set(["是","有","在","了","着","过","的","地","得","就","也","都","还","又","更","最","很","太","只","才","刚","已","曾","将","要","会","能"]),O=new Set(p);function W(r){return r?r.replace(/[^\u4e00-\u9fa5a-zA-Z0-9\s]/g," ").replace(/\s+/g," ").trim():""}function w(r){if(!r)return[];const n=[],e=/[\u4e00-\u9fa5]/g,s=r.match(e)||[];for(let c=0;c<s.length-1;c++){if(c+1<s.length){const o=s[c]+s[c+1];n.push(o)}if(c+2<s.length){const o=s[c]+s[c+1]+s[c+2];n.push(o)}}const u=r.match(/[a-zA-Z]{2,3}/g)||[];return[...n,...u]}function m(r){const n=r.trim();if(n.length<2||n.length>3||/^\d+$/.test(n)||O.has(n)||S.has(n))return!0;const e=n[0],s=n[n.length-1];return!!(g.has(e)||g.has(s)||n.length===2&&n[0]===n[1]&&!new Set(["哈哈","呵呵","嘿嘿","嘻嘻"]).has(n))}function y(r,n){const e={...r},s=Object.keys(r);for(let t=0;t<s.length;t++){const i=s[t];if(i.length===2)for(let f=t+1;f<s.length;f++){const l=s[f];if(l.length===2&&i[i.length-1]===l[0]){const a=i+l.substring(1);if(a.length>3)continue;const h=r[i]||0,d=r[l]||0;h>=2&&d>=2&&!m(a)&&(e[a]=(e[a]||0)+Math.min(h,d),e[i]=Math.max(0,(e[i]||0)-1),e[l]=Math.max(0,(e[l]||0)-1))}}}Object.keys(e).forEach(t=>{(e[t]<=0||t.length>3)&&delete e[t]});const u=new Set(["车回家","回家路","突然想","然想","来才知","为什","直以来","年纪大","多吃青","吃青菜","期播客","求同存","同存异","付密码","支付密","欢吃橄","喜欢吃","来的时","工作变","作变动","些小孔","用高压","午节前","些难以","压锅煮","医生日","半年纪","段时间","车回答","记忆医","青年纪","然想","段时","女之"]);for(const t of u)e[t]&&delete e[t];const c=new Set(["手机","城市","生活","医生","游戏","电话","微信","周末","公司","火车","软件","阳台","大学","同事","女生","北京","高中","初中","印象","东西","开心","以前","记忆","认识","之前","朋友","工作","健康","回家","喜欢","日子","老家","春节","白糖","能力","使用"]),o=Object.keys(e);for(const t of o)t.length>=2&&t.length<=3&&o.some(f=>f===t||f.length<=t.length?!1:f.includes(t)&&(e[f]||0)>=(e[t]||0))&&!c.has(t)&&delete e[t];if(n){const t=Object.keys(e);for(const i of t)if(i.length>=3&&(e[i]||0)<8){const f=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=new RegExp(`[\\u4e00-\\u9fa5]?${f}[\\u4e00-\\u9fa5]?`,"g"),a=[];let h,d=0;for(;(h=l.exec(n))!==null;)a.push(h[0]),h.index===d&&l.lastIndex++,d=h.index;a.length>0&&a.filter(x=>x===i).length/a.length<.3&&delete e[i]}}return e}function R(r,n){const e={};r.forEach(o=>{const t=o.trim();t.length<2||t.length>3||m(t)||(e[t]=(e[t]||0)+1)});const s=y(e,n),u={};return Object.keys(s).forEach(o=>{o.length>=2&&o.length<=3&&(u[o]=s[o])}),Object.entries(u).map(([o,t])=>[o,t]).sort((o,t)=>t[1]-o[1])}self.onmessage=function(r){const{text:n}=r.data;try{const e=W(n),s=w(e),c=R(s,n).slice(0,100);self.postMessage({success:!0,data:c})}catch(e){console.error("[WordCloud Worker] 处理出错:",e),self.postMessage({success:!1,error:e.message})}}})();
